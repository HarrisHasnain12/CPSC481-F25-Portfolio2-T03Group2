<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Expo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Base styles + event card styles -->
  <link rel="stylesheet" href="home_page.css" />
  <link rel="stylesheet" href="browse_events.css" />
</head>

<body>
  <div class="phone">

    <!-- HEADER -->
    <header class="home-header detail-header">
      <div class="expo-logo">
        <span style="font-size: 0.9em;">My Schedule</span>
      </div>
    </header>

    <!-- DATE ROW -->
    <div class="date-row">
      <button class="date-btn active">
        <span class="date-top">Apr 23</span>
        <span class="date-bottom">THU</span>
      </button>

      <button class="date-btn">
        <span class="date-top">Apr 24</span>
        <span class="date-bottom">FRI</span>
      </button>

      <button class="date-btn">
        <span class="date-top">Apr 25</span>
        <span class="date-bottom">SAT</span>
      </button>

      <button class="date-btn">
        <span class="date-top">Apr 26</span>
        <span class="date-bottom">SUN</span>
      </button>
    </div>

    <!-- BODY -->
    <main class="home-body schedule-body">
      <div id="eventList"></div>
    </main>

    <!-- NAV BAR -->
    <nav class="tab-bar">
      <a class="tab-item" href="home_page.html">
        <div class="tab-icon">ð– ¿</div>
        <div class="tab-label">Home</div>
      </a>
      <a class="tab-item" href="browse_events.html">
        <div class="tab-icon">â˜†</div>
        <div class="tab-label">Events</div>
      </a>
      <a class="tab-item" href="convention_map.html">
        <div class="tab-icon">âž¢</div>
        <div class="tab-label">Navigation</div>
      </a>
      <a class="tab-item active" href="my_expo.html">
        <div class="tab-icon" style="padding-top: 3px;">â˜ºï¸Ž</div>
        <div class="tab-label">My Expo</div>
      </a>
      <a class="tab-item" href="more.html">
        <div class="tab-icon">â˜°</div>
        <div class="tab-label">More</div>
      </a>
    </nav>
  </div>

  <script>
    const STORAGE_KEY = "convention_panels";

    // ---------- MAIN MY EXPO LOGIC ----------
    document.addEventListener("DOMContentLoaded", function () {
      const eventList = document.getElementById("eventList");
      const dateButtons = document.querySelectorAll(".date-btn");

      const dateMap = {
        "Apr 23": "April 23rd",
        "Apr 24": "April 24th",
        "Apr 25": "April 25th",
        "Apr 26": "April 26th"
      };

      const savedData = localStorage.getItem(STORAGE_KEY);

      if (!savedData) {
        eventList.innerHTML ="<p style='margin-top:20px; text-align:center;'>No events in your schedule yet. Add events from the Events page.</p>";   
        return;
      }

      let panels;
      try {
        panels = JSON.parse(savedData);
      } catch (err) {
        console.error("Error reading saved events:", err);
        eventList.innerHTML = "<p>Could not read saved events.</p>";
        return;
      }

      const events = Array.isArray(panels.events) ? panels.events : [];

      showEvents("April 23rd");

      dateButtons.forEach(function (button) {
        button.addEventListener("click", function () {
          document.querySelector(".date-btn.active").classList.remove("active");
          button.classList.add("active");

          const shortDate = button.querySelector(".date-top").textContent.trim();
          const fullDate = dateMap[shortDate];
          if (fullDate) {
            showEvents(fullDate);
          }
        });
      });

      function showEvents(dateString) {
        eventList.innerHTML = "";

        const myEvents = events.filter(function (e) {
          return e.added_to_my_expo && e.date === dateString;
        });

        if (myEvents.length === 0) {
          eventList.innerHTML =
            "<p style='margin-top:20px; text-align:center;'>No events in your schedule for this day.</p>";
          return;
        }

        myEvents.forEach(function (event) {
          const item = document.createElement("div");
          item.className = "event-item";

          const topRow = document.createElement("div");
          topRow.className = "event-top-row";

          const left = document.createElement("div");
          left.className = "event-left";

          const thumb = document.createElement("div");
          thumb.className = "event-thumb";

          const img = document.createElement("img");
          img.src = event.image;
          img.alt = event.name;

          const tag = document.createElement("div");
          tag.className = "event-tag-small";
          tag.textContent = event.property || "";

          thumb.appendChild(img);
          thumb.appendChild(tag);
          left.appendChild(thumb);

          const center = document.createElement("div");
          center.className = "event-center";

          const nameEl = document.createElement("div");
          nameEl.className = "event-name";
          nameEl.textContent = event.name;

          const timeEl = document.createElement("div");
          timeEl.className = "event-time";
          timeEl.textContent = event.start_time + " â€“ " + event.end_time;

          const panelEl = document.createElement("div");
          panelEl.className = "event-panel";
          panelEl.textContent = "Panel: " + event.panel;

          center.appendChild(nameEl);
          center.appendChild(timeEl);
          center.appendChild(panelEl);

          topRow.appendChild(left);
          topRow.appendChild(center);

          const bottomButtons = document.createElement("div");
          bottomButtons.className = "event-bottom-buttons";

          const detailsBtn = document.createElement("button");
          detailsBtn.className = "event-btn view-details-btn";
          detailsBtn.textContent = "View Details";
          detailsBtn.addEventListener("click", function () {
            window.location.href = event.event_detail_page;
          });

          const removeBtn = document.createElement("button");
          removeBtn.className = "event-btn expo-toggle-btn remove";
          removeBtn.textContent = "Remove from My Expo";
          removeBtn.addEventListener("click", function () {
            event.added_to_my_expo = false;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(panels));
            showEvents(dateString); 
          });

          bottomButtons.appendChild(detailsBtn);
          bottomButtons.appendChild(removeBtn);

          item.appendChild(topRow);
          item.appendChild(bottomButtons);

          eventList.appendChild(item);
        });
      }
    });
  </script>
</body>
</html>
