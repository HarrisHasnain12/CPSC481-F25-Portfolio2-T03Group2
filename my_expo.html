<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Expo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="home_page.css" />
  <link rel="stylesheet" href="browse_events.css" />
</head>

<body>
  <div class="phone">

    <!-- HEADER -->
    <header class="home-header detail-header">
      <div class="expo-logo">
        <span style="font-size: 0.9em;">My Schedule</span>
      </div>
      <div class="search">üîç</div>
    </header>

    <!-- DATE ROW -->
    <div class="date-row">
      <button class="date-btn active">
        <span class="date-top">Apr 23</span>
        <span class="date-bottom">THU</span>
      </button>

      <button class="date-btn">
        <span class="date-top">Apr 24</span>
        <span class="date-bottom">FRI</span>
      </button>

      <button class="date-btn">
        <span class="date-top">Apr 25</span>
        <span class="date-bottom">SAT</span>
      </button>

      <button class="date-btn">
        <span class="date-top">Apr 26</span>
        <span class="date-bottom">SUN</span>
      </button>
    </div>

    <!-- BODY -->
    <main class="home-body schedule-body">
      <div id="eventList"></div>
    </main>

    <!-- NAV BAR -->
    <nav class="tab-bar">
      <a class="tab-item" href="home_page.html">
        <div class="tab-icon">ñ†ø</div>
        <div class="tab-label">Home</div>
      </a>
      <a class="tab-item" href="browse_events.html">
        <div class="tab-icon">‚òÜ</div>
        <div class="tab-label">Events</div>
      </a>
      <a class="tab-item" href="convention_map.html">
        <div class="tab-icon">‚û¢</div>
        <div class="tab-label">Navigation</div>
      </a>
      <a class="tab-item active" href="my_expo.html">
        <div class="tab-icon" style="padding-top: 3px;">‚ò∫Ô∏é</div>
        <div class="tab-label">My Expo</div>
      </a>
      <a class="tab-item" href="more.html">
        <div class="tab-icon">‚ò∞</div>
        <div class="tab-label">More</div>
      </a>
    </nav>
  </div>

  <script>
  const STORAGE_KEY = "convention_panels";

  document.addEventListener("DOMContentLoaded", () => {
    const eventList = document.getElementById("eventList");
    const dateButtons = document.querySelectorAll(".date-btn");

    const dateMap = {
      "Apr 23": "April 23rd",
      "Apr 24": "April 24th",
      "Apr 25": "April 25th",
      "Apr 26": "April 26th"
    };

    // Load events from localStorage 
    const savedData = localStorage.getItem(STORAGE_KEY);

    if (!savedData) {
      eventList.innerHTML = "Could not load events.";
      return;
    }

    const panels = JSON.parse(savedData);
    const events = panels.events;

    //Show default day
    showEvents("April 23rd");

    //Date switching
    dateButtons.forEach(button => {
      button.addEventListener("click", () => {
        document.querySelector(".date-btn.active").classList.remove("active");
        button.classList.add("active");

        const shortDate = button.querySelector(".date-top").textContent;
        const fullDate = dateMap[shortDate];

        showEvents(fullDate);
      });
    });

    // MAIN DISPLAY FUNCTION
    function showEvents(date) {
      eventList.innerHTML = "";

      const myEvents = events.filter(e =>
        e.added_to_my_expo && e.date === date
      );

      if (myEvents.length === 0) {
        eventList.innerHTML = "No events in your schedule.";
        return;
      }

      myEvents.forEach(event => {
        const div = document.createElement("div");
        div.className = "event-item";

        div.innerHTML = `
          <div class="event-name">${event.name}</div>
          <div class="event-time">${event.start_time} ‚Äì ${event.end_time}</div>
          <div class="event-panel">Panel ${event.panel}</div>

          <button class="event-btn view">View Details</button>
          <button class="event-btn remove">Remove from My Expo</button>
        `;

        // View event page
        div.querySelector(".view").onclick = () => {
          window.location.href = event.event_detail_page;
        };

        // Remove from My Expo (SAME LOGIC AS BROWSE PAGE)
        div.querySelector(".remove").onclick = () => {
          event.added_to_my_expo = false;
          localStorage.setItem(STORAGE_KEY, JSON.stringify(panels));
          div.remove();
        };

        eventList.appendChild(div);
      });
    }
  });
</script>
  </body>
</html> 